function newShape(){currentPath=new Path,currentPath.set({strokeColor:"black",dashArray:[10,6],strokeWidth:2,strokeCap:"round",strokeJoin:"round"})}function closePath(){currentPath&&(currentPath.selected=!1,currentPath.set({strokeColor:null,strokeWidth:0}),currentPath.closed=!0),"layerBg"!==app.activeLayer&&(paper.project.activeLayer.getItem({"class":paper.CompoundPath}).addChild(currentPath),newShape())}function canvasExport(){paper.view.draw(),paper.view.element.toBlob(function(e){saveAs(e,"littleWhittle.png")})}function clearLayer(e){5!==paper.project.layers[e].index?(paper.project.layers[e].getItem({"class":CompoundPath}).removeChildren(1),paper.view.draw()):(paper.project.layers[e].getItem({"class":paper.Raster}).set({source:null}),$("."+app.activeLayer+" .texture").css({backgroundImage:"none"}))}function setLayerColor(e,a){app.layers[app.activeLayer].fillColor=e,app.layers[app.activeLayer].opacity=a,"layerBg"!==app.activeLayer?(project.layers[app.activeLayerIndex].firstChild.children[1].set({fillColor:e}),project.layers[app.activeLayerIndex].firstChild.set({opacity:a})):(project.layers[app.activeLayerIndex].getItem({"class":paper.Path}).set({fillColor:e}),project.layers[app.activeLayerIndex].firstChild.set({opacity:a}))}function onMouseDown(e){if("layerBg"!==app.activeLayer)if(currentPath.isEmpty())currentPath.add(e.point);else{var a=e.point.getDistance(currentPath._segments[0].point);15>a?closePath():currentPath.add(e.point)}}function onMouseDrag(e){"layerBg"!==app.activeLayer&&("free"===app.tool?currentPath.add(e.point):"poly"!==app.tool||currentPath.closed||currentPath.segments[currentPath.lastSegment.index].set({point:e.point}))}function onMouseUp(e){"free"===app.tool&&"layerBg"!==app.activeLayer&&closePath()}function onKeyDown(e){if(e.preventDefault(),"backspace"===e.key)currentPath.isEmpty()||currentPath.removeSegment(currentPath.lastSegment.index);else if("space"===e.key);else if("enter"===e.key)closePath();else if("1"===e.key)activateLayer("layer1",1);else if("2"===e.key)activateLayer("layer2",2);else if("3"===e.key)activateLayer("layer3",3);else if("4"===e.key)activateLayer("layer4",4);else if("0"===e.key)activateLayer("layerBg",0);else if(e.modifiers.shift&&"n"===e.key){var a=confirm("Are you sure you want to start new?");if(1==a)for(var r=document.querySelectorAll(".layers > div"),t=0;t<r.length;t++)clearLayer(t)}else if(e.modifiers.shift&&"l"===e.key){var l=confirm("Reset layer?");1==l&&clearLayer(app.activeLayerIndex)}else e.modifiers.shift&&"e"===e.key?canvasExport():"q"===e.key?(activateLayer("layer1",1),$("[data-remodal-id=modal]").remodal().open()):"w"===e.key?(activateLayer("layer2",2),$("[data-remodal-id=modal]").remodal().open()):"e"===e.key?(activateLayer("layer3",3),$("[data-remodal-id=modal]").remodal().open()):"r"===e.key?(activateLayer("layer4",4),$("[data-remodal-id=modal]").remodal().open()):"p"===e.key?(activateLayer("layerBg",0),$("[data-remodal-id=modal]").remodal().open()):"c"===e.key?(app.tool="free",$(".lassoPoly").removeClass("active"),$(".lassoFree").addClass("active")):"v"===e.key&&(app.tool="poly",$(".lassoFree").removeClass("active"),$(".lassoPoly").addClass("active"))}function activateLayer(e,a){app.activeLayer=e.replace(/ activeLayer/,""),app.activeLayerIndex=a,paper.project.layers[a].activate(),highlightActiveLayer(e),closePath()}function highlightActiveLayer(e){e.includes("activeLayer")||($(".layers > div").removeClass("activeLayer"),$("."+e).addClass("activeLayer"))}function selectLayer(e){switch(this.className.replace(/ activeLayer/,"")){case"layerBg":activateLayer(this.className,0);break;case"layer1":activateLayer(this.className,1);break;case"layer2":activateLayer(this.className,2);break;case"layer3":activateLayer(this.className,3);break;case"layer4":activateLayer(this.className,4);break;default:alert("error selecting layer!")}}function setTexture(e){var a=paper.project.activeLayer.getItem({"class":paper.Raster});a.set({source:"/assets/textures/"+e}),$("."+app.activeLayer+" .texture").css({backgroundImage:'url("/assets/textures/small/'+e+'")',backgroundPosition:"top",border:"none",width:"100%",height:"80px"})}var tempPath;window._app={tool:"free",activeLayer:"layer1",activeLayerIndex:1,activePath:tempPath,fillColor:"#FFAABB",strokeColor:"#43597D",layers:{layerBg:{fillColor:"#c8c0ba",texture:null,opacity:1},layer1:{fillColor:"#931ba8",texture:"texture_02.png",opacity:1},layer2:{fillColor:"#d7d518",texture:null,opacity:1},layer3:{fillColor:"#14deaf",texture:"texture_10.png",opacity:1},layer4:{fillColor:"#ffb661",texture:null,opacity:1}}},$(".export").on("click",canvasExport),$(".clear").on("click",function(){var e=confirm("Reset layer?");1==e&&clearLayer(app.activeLayerIndex)}),$(".clearAll").on("click",function(){var e=confirm("Are you sure you want to start new?");if(1==e)for(var a=document.querySelectorAll(".layers > div"),r=0;r<a.length;r++)clearLayer(r)}),$(".edit").attr("data-remodal-target","modal"),$(".picker.colorPicker").minicolors({changeDelay:15,opacity:!0,inline:!0,change:function(e,a){setLayerColor(e,a),$("."+app.activeLayer).css("background-color",e)}});var app=_app,currentPath;newShape(),$(".lassoFree").on("click",function(){app.tool="free",$(this).addClass("active"),$(".lassoPoly").removeClass("active")}),$(".lassoPoly").on("click",function(){app.tool="poly",$(this).addClass("active"),$(".lassoFree").removeClass("active")}),$(".shortcut").attr("data-remodal-target","modalKeys"),$(document).ready(function(){$("[data-remodal-id=modalKeys]").remodal().open(),$(".lassoFree").addClass("active")});var numOfLayers=document.querySelectorAll(".layers > div");highlightActiveLayer("layer3");for(var bounds=paper.project.view.viewSize,i=0;i<numOfLayers.length;i++){var layerName=numOfLayers[i].className.toString().replace(/ activeLayer/,""),layerColor=app.layers[layerName].fillColor,layerTexture=app.layers[layerName].texture?"/assets/textures/"+app.layers[layerName].texture:null;new Layer;var textureImage=new Raster(layerTexture),layerBg=new Path.Rectangle(0,0,bounds._width,bounds._height);if(layerBg.set({fillColor:layerColor}),"layerBg"!==layerName)var compClipMask=new CompoundPath({clipMask:!0}),layerGroup=new Group([compClipMask,layerBg,textureImage]);else var layerGroup=new Group([layerBg,textureImage]);numOfLayers[i].addEventListener("click",selectLayer)}paper.project.layers.reverse(),activateLayer("layerBg",0),activateLayer("layer4",4),activateLayer("layer3",3),activateLayer("layer2",2),activateLayer("layer1",1),paper.project.view.draw(),$(".texturePicker img").on("click",function(){setTexture($(this).attr("data"))});